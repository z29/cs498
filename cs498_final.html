<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <h1>My Weightloss Journal</h1>
    </head>

    <style> 
        .dot {
            fill: #ffab00;
            stroke: #fff;
        }

        .hoverDot {
            fill: #ff0000;
            stroke: #fff;
        }

        .hidden{
            display: none;
        }

        .curr{
            display: block;
        }

        .slide{
            display: inline;
        }

        div.tooltip {	
            position: absolute;			
            text-align: center;			
            width: 100px;					
            height: 28px;					
            padding: 2px;				
            font: 12px sans-serif;		
            background: lightsteelblue;	
            border: 0px;		
            border-radius: 8px;			
            pointer-events: none;			
        }
    </style>

    <body onload="initWeight()">
        <p>Soon after quarantine started, I decided to become fit. This is my journey so far</p>
        <div class="slides">
            <div class="slide"> 
                <input name="weight" 
                       type="button"
                       value="1" 
                       onclick="hideDivs('weight')" />
            </div>
            <div class="slide">
                <input name="fatvsmuscle" 
                       type="button"
                       value="2" 
                       onclick="hideDivs('fatvsmuscle')" />
            </div>
            <div class="slide"> 
                <input name="exercise" 
                       type="button"
                       value="3" 
                       onclick="hideDivs('exercise')" />
            </div>
        </div>

        <div class="curr" id="weight">
            <div class="slide"> 
                <input name="weightButton" 
                       type="button"
                       value="Daily" 
                       onclick="weightGraph()" />
            </div>
            <div class="slide">
                <input name="weeklyWeightButton" 
                       type="button"
                       value="Weekly" 
                       onclick="weeklyWeightGraph()" />
            </div>
        </div>

        <div class = "hidden" id="fatvsmuscle">
            <div class="slide"> 
                <input name="fatMuscleBar" 
                       type="button"
                       value="Daily" 
                       onclick="fatmuscleGraph()" />
            </div>
            <div class="slide">
                <input name="fatMuscleRatio" 
                       type="button"
                       value="Weekly" 
                       onclick="fatMuscleRatioGraph()" />
            </div>
        </div>

        <div class = "hidden" id="exercise"><h1>TESTING 2</h1></div>

        <div id="tooltip"></div>

        <script>
            var margin = {top: 10, right: 30, bottom: 30, left: 60},
            width = 960 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

            var div = d3.select("body").append("div")	
                .attr("class", "tooltip")				
                .style("opacity", 0);

            var weightline = d3.line()
                .x(function(d) { return x(d.date) })
                .y(function(d) { return y(+d.totalweight) })

            var muscletofatline = d3.line()
                .x(function(d) { return x(d.date) })
                .y(function(d) { return y(+d.muscletofat) })
            

            var x = d3.scaleTime()
                .range([ 0, width ]);

            var y = d3.scaleLinear()
                .range([ height, 0 ]);

            var xaxis = d3.axisBottom(x).ticks(d3.timeWeek.every(1)).tickFormat(d3.timeFormat("%b %d"))
            var yaxis = d3.axisLeft(y)

            // append the svg object to the body of the page
            var svgWeight = d3.select("#weight")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .style("display", "block")
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");
            
            var svgFatMuscled = d3.select("#fatvsmuscle")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .style("display", "block")
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

            function initWeight(){
                d3.csv("https://raw.githubusercontent.com/z29/testing/master/weightloss_data.csv",
                    function(d){ return { 
                        date : d3.timeParse("%m/%d/%Y")(d.date),  
                        totalweight : +d.totalweight,
                        fatpercentage : +d.fatpercentage,
                        fatweight : +d.fatweight,
                        muscleweight : +d.muscleweight,
                        muscletofat : +d.muscletofat,
                        totalcalories : +d.totalcalories,
                        calorieseaten : +d.calorieseaten,
                        exercise : +d.exercise,
                        caloriesremaining : +d.caloriesremaining,
                        carbs : +d.carbs,
                        fat : +d.fat,
                        protein : +d.protein,
                        mmr : +d.mmr,
                        tdee : +d.tdee,
                        expectedweight : +d.expectedweight
                        }
                    },
                    function(data) {
                        cleanSlides()
                        x.domain(d3.extent(data, function(d) { return new Date(d.date); }));
                        y.domain([200, 225]);

                        svgWeight.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .attr("class","xaxis")
                            .call(xaxis);

                        svgWeight.append("g")
                            .attr("class","yaxis")
                            .call(yaxis);

                        const transitionPath = d3.transition().ease(d3.easeSin).duration(2500);
                        //const pathLength = path.node().getTotalLength();

                        svgWeight.append("path")
                            .datum(data)
                            .attr("fill", "none")
                            .attr("stroke", "steelblue")
                            .attr("stroke-width", 1.5)
                            .attr("class", "line")
                            .attr("d", weightline(data))
                            .attr('stroke-dashoffset', 10000)    
                            .attr('stroke-dasharray', 10000)    
                            .transition(transitionPath)
                            .attr('stroke-dashoffset',0)
                        
                        svgWeight.append("text")
                            .attr("x", (width /2))
                            .attr("y", 0 - (margin.top / 2 - 20))
                            .attr("text-anchor", "middle")
                            .attr("class", "chartTitle")
                            .style("font-size", "24px")
                            .style("text-decoration", "underline")
                            .text("Daily Weight")
                    }
                )
            }
            function weightGraph(){
                d3.csv("https://raw.githubusercontent.com/z29/testing/master/weightloss_data.csv",
                    function(d){ return { 
                        date : d3.timeParse("%m/%d/%Y")(d.date),  
                        totalweight : +d.totalweight,
                        }
                    },
                    function(data) {
                        cleanSlides();
                        x.domain(d3.extent(data, function(d) { return new Date(d.date); }));
                        y.domain([200, 225]);

                        var svg_transition = d3.select("#weight").transition();

                        const transitionPath = d3.transition().ease(d3.easeSin).duration(3000);
                        //const pathLength = path.node().getTotalLength();

                        svgWeight.append("path")
                            .datum(data)
                            .attr("fill", "none")
                            .attr("stroke", "steelblue")
                            .attr("stroke-width", 1.5)
                            .attr("class", "line")
                            .attr("d", weightline(data))
                            .attr('stroke-dashoffset', 10000)    
                            .attr('stroke-dasharray', 10000)    
                            .transition(transitionPath)
                            .attr('stroke-dashoffset',0)

                        svg_transition.select(".xaxis")
                            .duration(750)
                            .call(xaxis);

                        svg_transition.select(".yaxis")
                            .duration(750)
                            .call(yaxis);
                        
                        d3.select(".chartTitle").remove();

                        svgWeight.append("text")
                            .attr("x", (width /2))
                            .attr("y", 0 - (margin.top / 2 - 20))
                            .attr("text-anchor", "middle")
                            .attr("class", "chartTitle")
                            .style("font-size", "24px")
                            .style("text-decoration", "underline")
                            .text("Daily Weight")

                    }
                )
            }
            function weeklyWeightGraph(){
                d3.csv("https://raw.githubusercontent.com/z29/testing/master/weightloss_weekly_data.csv",

                    function(d){ return { 
                        date : d3.timeParse("%m/%d/%Y")(d.date),  
                        totalweight : +d.totalweight,
                        }
                    },
                    function(data) {
                        
                        cleanSlides();
                        x.domain(d3.extent(data, function(d) { return new Date(d.date); }));
                        y.domain([200, 225]);

                        var svg_transition = d3.select("#weight").transition();
                        svgWeight.selectAll("circle")
                            .data(data)
                            .enter().append("circle")
                            .attr("r", 0)
                            .attr("cx", function(d) { return x(d.date); })
                            .attr("cy", function(d) { return y(d.totalweight); })
                            .attr("class", "dot")
                            .on("mouseover", function(d,i) {		
                                div.transition()		
                                    .duration(200)		
                                    .style("opacity", .9);		
                                div	.html("Week " + i + "<br/>Weight = "  + d.totalweight)	
                                    .style("left", (d3.event.pageX) + "px")		
                                    .style("top", (d3.event.pageY) + "px");	
                                })					
                            .on("mouseout", function(d) {		
                                div.transition()		
                                    .duration(500)		
                                    .style("opacity", 0);	
                            })
                            .transition()
                            .duration(1500)
                            .attr("r",5)

                        svg_transition.select(".line")
                            .duration(750)
                            .attr("d", weightline(data));

                        svg_transition.select(".xaxis")
                            .duration(750)
                            .call(xaxis);

                        svg_transition.select(".yaxis")
                            .duration(750)
                            .call(yaxis);

                        svgWeight.append("text")
                            .attr("x", (width /2))
                            .attr("y", 0 - (margin.top / 2 - 20))
                            .attr("text-anchor", "middle")
                            .attr("class", "chartTitle")
                            .style("font-size", "24px")
                            .style("text-decoration", "underline")
                            .text("Weekly Weight Avg")
                        
                    }
                )
            }

            function fatmuscleGraph(){
                d3.csv("https://raw.githubusercontent.com/z29/testing/master/weightloss_weekly_data.csv",

                    function(d){ return { 
                        date : d3.timeParse("%m/%d/%Y")(d.date),  
                        totalweight : +d.totalweight,
                        fatpercentage : +d.fatpercentage,
                        fatweight : +d.fatweight,
                        muscleweight : +d.muscleweight,
                        muscletofat : +d.muscletofat,
                        totalcalories : +d.totalcalories,
                        calorieseaten : +d.calorieseaten,
                        exercise : +d.exercise,
                        caloriesremaining : +d.caloriesremaining,
                        carbs : +d.carbs,
                        fat : +d.fat,
                        protein : +d.protein,
                        mmr : +d.mmr,
                        tdee : +d.tdee,
                        expectedweight : +d.expectedweight
                        }
                    },
                    function(data) {
                        cleanSlides()
                        x.domain(d3.extent(data, function(d) { return new Date(d.date); }));
                        y.domain([2, 3]);

                        svgFatMuscled.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .attr("class","xaxis")
                            .call(xaxis);

                        svgFatMuscled.append("g")
                            .attr("class","yaxis")
                            .call(yaxis);
                        
                        svgFatMuscled.append("text")
                            .attr("x", (width /2))
                            .attr("y", 0 - (margin.top / 2 - 20))
                            .attr("text-anchor", "middle")
                            .attr("class", "chartTitle")
                            .style("font-size", "24px")
                            .style("text-decoration", "underline")
                            .text("Muscle to Fat Ratio")
                        
                        
                    }
                )
            }

            function fatMuscleRatioGraph(){
                d3.csv("https://raw.githubusercontent.com/z29/testing/master/weightloss_weekly_data.csv",

                    function(d){ return { 
                        date : d3.timeParse("%m/%d/%Y")(d.date),  
                        totalweight : +d.totalweight,
                        fatpercentage : +d.fatpercentage,
                        fatweight : +d.fatweight,
                        muscleweight : +d.muscleweight,
                        muscletofat : +d.muscletofat,
                        totalcalories : +d.totalcalories,
                        calorieseaten : +d.calorieseaten,
                        exercise : +d.exercise,
                        caloriesremaining : +d.caloriesremaining,
                        carbs : +d.carbs,
                        fat : +d.fat,
                        protein : +d.protein,
                        mmr : +d.mmr,
                        tdee : +d.tdee,
                        expectedweight : +d.expectedweight
                        }
                    },
                    function(data) {
                        cleanSlides()
                        x.domain(d3.extent(data, function(d) { return new Date(d.date); }));
                        y.domain([2, 3]);

                        svgFatMuscled.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .attr("class","xaxis")
                            .call(xaxis);

                        svgFatMuscled.append("g")
                            .attr("class","yaxis")
                            .call(yaxis);

                        svgFatMuscled.append("path")
                            .datum(data)
                            .attr("fill", "none")
                            .attr("stroke", "steelblue")
                            .attr("stroke-width", 1.5)
                            .attr("class", "line")
                            .attr("d", muscletofatline(data))
                        
                        svgFatMuscled.append("text")
                            .attr("x", (width /2))
                            .attr("y", 0 - (margin.top / 2 - 20))
                            .attr("text-anchor", "middle")
                            .attr("class", "chartTitle")
                            .style("font-size", "24px")
                            .style("text-decoration", "underline")
                            .text("Muscle to Fat Ratio")
                        
                        svgFatMuscled.selectAll("circle")
                            .data(data)
                            .enter().append("circle")
                            .attr("r", 0)
                            .attr("cx", function(d) { return x(d.date); })
                            .attr("cy", function(d) { return y(d.muscletofat); })
                            .attr("class", "dot")
                            .on("mouseover", function(d,i) {		
                                div.transition()		
                                    .duration(200)		
                                    .style("opacity", .9);		
                                div	.html("Week " + i + "<br/>Ratio = "  + d.muscletofat)	
                                    .style("left", (d3.event.pageX) + "px")		
                                    .style("top", (d3.event.pageY) + "px");	
                                })					
                            .on("mouseout", function(d) {		
                                div.transition()		
                                    .duration(500)		
                                    .style("opacity", 0);	
                            })
                            .transition()
                            .duration(1500)
                            .attr("r",5)
                    }
                )
            }

            function fatMuscleRatioGraph(){
                d3.csv("https://raw.githubusercontent.com/z29/testing/master/weightloss_weekly_data.csv",

                    function(d){ return { 
                        date : d3.timeParse("%m/%d/%Y")(d.date),  
                        totalweight : +d.totalweight,
                        fatpercentage : +d.fatpercentage,
                        fatweight : +d.fatweight,
                        muscleweight : +d.muscleweight,
                        muscletofat : +d.muscletofat,
                        totalcalories : +d.totalcalories,
                        calorieseaten : +d.calorieseaten,
                        exercise : +d.exercise,
                        caloriesremaining : +d.caloriesremaining,
                        carbs : +d.carbs,
                        fat : +d.fat,
                        protein : +d.protein,
                        mmr : +d.mmr,
                        tdee : +d.tdee,
                        expectedweight : +d.expectedweight
                        }
                    },
                    function(data) {
                        cleanSlides()
                        x.domain(d3.extent(data, function(d) { return new Date(d.date); }));
                        y.domain([2, 3]);

                        svgFatMuscled.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .attr("class","xaxis")
                            .call(xaxis);

                        svgFatMuscled.append("g")
                            .attr("class","yaxis")
                            .call(yaxis);

                        svgFatMuscled.append("path")
                            .datum(data)
                            .attr("fill", "none")
                            .attr("stroke", "steelblue")
                            .attr("stroke-width", 1.5)
                            .attr("class", "line")
                            .attr("d", muscletofatline(data))
                        
                        svgFatMuscled.append("text")
                            .attr("x", (width /2))
                            .attr("y", 0 - (margin.top / 2 - 20))
                            .attr("text-anchor", "middle")
                            .attr("class", "chartTitle")
                            .style("font-size", "24px")
                            .style("text-decoration", "underline")
                            .text("Muscle to Fat Ratio")
                        
                        svgFatMuscled.selectAll("circle")
                            .data(data)
                            .enter().append("circle")
                            .attr("r", 0)
                            .attr("cx", function(d) { return x(d.date); })
                            .attr("cy", function(d) { return y(d.muscletofat); })
                            .attr("class", "dot")
                            .on("mouseover", function(d,i) {		
                                div.transition()		
                                    .duration(200)		
                                    .style("opacity", .9);		
                                div	.html("Week " + i + "<br/>Ratio = "  + d.muscletofat)	
                                    .style("left", (d3.event.pageX) + "px")		
                                    .style("top", (d3.event.pageY) + "px");	
                                })					
                            .on("mouseout", function(d) {		
                                div.transition()		
                                    .duration(500)		
                                    .style("opacity", 0);	
                            })
                            .transition()
                            .duration(1500)
                            .attr("r",5)
                    }
                )
            }

            function cleanSlides(){
                d3.selectAll(".dot").remove();
                d3.select(".chartTitle").remove();
            }

            function hideDivs(curr){
                console.log(curr);
                if(curr === "weight"){
                    d3.select('#weight').classed("curr", true).classed("hidden", false)
                    d3.select('#fatvsmuscle').classed("hidden", true).classed("curr", false)
                    d3.select('#exercise').classed("hidden", true).classed("curr", false)
                    initWeight();
                }
                else if(curr === "fatvsmuscle"){
                    d3.select('#fatvsmuscle').classed("curr", true).classed("hidden", false)
                    d3.select('#weight').classed("hidden", true).classed("curr", false)
                    d3.select('#exercise').classed("hidden", true).classed("curr", false)
                    fatMuscleRatioGraph();
                }
                else if(curr === "exercise"){
                    d3.select('#exercise').classed("curr", true).classed("hidden", false)
                    d3.select('#fatvsmuscle').classed("hidden", true).classed("curr", false)
                    d3.select('#weight').classed("hidden", true).classed("curr", false)
                }
            }

        </script>
    </body>
</html>